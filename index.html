<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rockstar Games - Auto Code Puller</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes pulse-once {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse-once {
            animation: pulse-once 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-purple-900 to-black text-white min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <div class="bg-gray-800/50 backdrop-blur-lg rounded-2xl shadow-2xl border border-purple-500/20 overflow-hidden">
            <!-- Header -->
            <div class="bg-gradient-to-r from-purple-600 to-pink-600 p-6">
                <h1 class="text-3xl font-bold">üéÆ Rockstar Games - Auto Code Puller</h1>
                <p class="text-purple-100 mt-2">‡∏î‡∏∂‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ </p>
            </div>

            <!-- Form -->
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">üìß ‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label>
                    <input type="email" id="email" placeholder="example@outlook.com"
                        class="w-full px-4 py-3 bg-gray-700/50 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 outline-none text-lg"
                        onkeypress="if(event.key==='Enter') startPulling()">
                </div>

                <div class="flex gap-3 pt-2">
                    <button onclick="startPulling()" id="startBtn"
                        class="flex-1 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 px-6 py-4 rounded-lg font-bold text-lg transition-all transform hover:scale-105 flex items-center justify-center gap-2">
                        <span id="btnText">üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏∂‡∏á‡πÇ‡∏Ñ‡πâ‡∏î</span>
                    </button>
                    <button onclick="clearAll()"
                        class="bg-gray-700 hover:bg-gray-600 px-6 py-4 rounded-lg font-bold transition-all">
                        üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á
                    </button>
                </div>
            </div>

            <!-- Code Display Container -->
            <div id="codeContainer" class="hidden mx-6 mb-6 space-y-3 max-h-96 overflow-y-auto">
            </div>

            <!-- Status Display -->
            <div id="statusDisplay" class="hidden mx-6 mb-6 bg-purple-900/30 border-2 border-purple-500 rounded-lg p-4">
                <p class="text-purple-300 font-medium" id="statusText"></p>
            </div>

            <!-- Error Display -->
            <div id="errorDisplay" class="hidden mx-6 mb-6 bg-red-900/30 border-2 border-red-500 rounded-lg p-4">
                <p class="text-red-300 font-medium" id="errorText"></p>
            </div>

            <!-- Instructions -->
            <div class="bg-gray-900/50 p-6 border-t border-gray-700">
                <h3 class="font-bold mb-3">‚ÑπÔ∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
                <ol class="space-y-2 text-sm text-gray-300">
                    <li>1. ‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</li>
                    <li>2. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏∂‡∏á‡πÇ‡∏Ñ‡πâ‡∏î"</li>
                    <li>3. ‡∏£‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢</li>
                    <li>4. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡πÜ ‡πÇ‡∏Ñ‡πâ‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</li>
                </ol>
            </div>
        </div>

        <div class="text-center mt-6 text-gray-400 text-sm">
            <p>üîí ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ 100%</p>
            <p>üåê ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Server: 141.98.17.64</p>
        </div>
    </div>

    <script>
        let isRunning = false;
        let foundCodes = [];

        // ‚ö†Ô∏è ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô HTTPS ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ö‡∏ô GitHub Pages
        // ‡∏ñ‡πâ‡∏≤ server ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ SSL ‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Cloudflare Tunnel ‡∏´‡∏£‡∏∑‡∏≠ Nginx + Let's Encrypt
        const API_URL = 'https://outlo0k.online:2096';

        function showStatus(message, type = 'info') {
            const statusDisplay = document.getElementById('statusDisplay');
            const statusText = document.getElementById('statusText');
            const errorDisplay = document.getElementById('errorDisplay');
            const errorText = document.getElementById('errorText');

            if (type === 'error') {
                errorDisplay.classList.remove('hidden');
                errorText.textContent = message;
                statusDisplay.classList.add('hidden');
            } else {
                statusDisplay.classList.remove('hidden');
                statusText.textContent = message;
                errorDisplay.classList.add('hidden');
            }
        }

        function clearAll() {
            document.getElementById('email').value = '';
            document.getElementById('codeContainer').classList.add('hidden');
            document.getElementById('codeContainer').innerHTML = '';
            document.getElementById('statusDisplay').classList.add('hidden');
            document.getElementById('errorDisplay').classList.add('hidden');
            foundCodes = [];
        }

        function copyCode(code) {
            navigator.clipboard.writeText(code);
            showStatus('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß: ' + code, 'info');
        }

        function addCodeToDisplay(code, time, isNew) {
            foundCodes.unshift({ code, time, isNew });

            const container = document.getElementById('codeContainer');
            container.classList.remove('hidden');

            const codeElement = document.createElement('div');

            if (isNew) {
                codeElement.className = 'bg-green-900/30 border-2 border-green-500 rounded-lg p-6 animate-pulse-once';
                codeElement.innerHTML = `
                    <div class="flex items-center justify-between flex-wrap gap-4">
                        <div class="flex-1">
                            <h3 class="text-xl font-bold text-green-400 mb-2">‚úÖ ‡∏û‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß!</h3>
                            <p class="text-5xl font-mono font-bold text-green-300">${code}</p>
                            <p class="text-sm text-green-200 mt-2">üìÖ ${time} (‡πÄ‡∏°‡∏•‡πÉ‡∏´‡∏°‡πà)</p>
                        </div>
                        <button onclick="copyCode('${code}')"
                            class="bg-green-600 hover:bg-green-700 px-6 py-3 rounded-lg font-bold transition-all flex items-center gap-2">
                            üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
                        </button>
                    </div>
                `;
            } else {
                codeElement.className = 'bg-blue-900/30 border-2 border-blue-500 rounded-lg p-6 animate-pulse-once';
                codeElement.innerHTML = `
                    <div class="flex items-center justify-between flex-wrap gap-4">
                        <div class="flex-1">
                            <h3 class="text-xl font-bold text-blue-400 mb-2">‚úÖ ‡∏û‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏•‡πâ‡∏ß!</h3>
                            <p class="text-5xl font-mono font-bold text-blue-300">${code}</p>
                            <p class="text-sm text-blue-200 mt-2">üìÖ ${time} (‡πÄ‡∏°‡∏•‡πÄ‡∏Å‡πà‡∏≤)</p>
                        </div>
                        <button onclick="copyCode('${code}')"
                            class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-bold transition-all flex items-center gap-2">
                            üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
                        </button>
                    </div>
                `;
            }

            container.appendChild(codeElement);
        }

        async function startPulling() {
            if (isRunning) return;

            const email = document.getElementById('email').value.trim();

            if (!email) {
                showStatus('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•!', 'error');
                return;
            }

            isRunning = true;

            document.getElementById('codeContainer').classList.add('hidden');
            document.getElementById('codeContainer').innerHTML = '';
            foundCodes = [];

            const startBtn = document.getElementById('startBtn');
            const btnText = document.getElementById('btnText');
            startBtn.disabled = true;
            startBtn.classList.add('opacity-50', 'cursor-not-allowed');

            try {
                showStatus(`üîç ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ç‡∏≠‡∏á ${email}...`, 'info');

                const response = await fetch(`${API_URL}/api/pull-code`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';

                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;

                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n');
                    buffer = lines.pop();

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = JSON.parse(line.slice(6));

                            if (data.type === 'status') {
                                showStatus(data.message, 'info');
                            } else if (data.type === 'old_code') {
                                const message = data.message;
                                const codeMatch = message.match(/‡∏û‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Å‡πà‡∏≤:\s*(\d+)/);
                                const timeMatch = message.match(/‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß\s+([^)]+)\)/);

                                if (codeMatch && timeMatch) {
                                    const oldCode = codeMatch[1];
                                    const oldTime = timeMatch[1];
                                    addCodeToDisplay(oldCode, `‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ${oldTime}`, false);
                                }

                                const waitingMsg = message.includes('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡∏°‡πà') ? 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏´‡∏°‡πà...' : data.message;
                                showStatus(waitingMsg, 'info');
                            } else if (data.type === 'all_codes') {
                                const codes = data.codes || [];
                                codes.forEach(codeData => {
                                    addCodeToDisplay(codeData.code, codeData.time, codeData.is_new);
                                });
                                document.getElementById('statusDisplay').classList.add('hidden');

                                if (codes.length > 0) {
                                    try { await navigator.clipboard.writeText(codes[0].code); } catch {}
                                }

                                isRunning = false;
                                startBtn.disabled = false;
                                startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                                btnText.innerHTML = 'üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏∂‡∏á‡πÇ‡∏Ñ‡πâ‡∏î';
                                return;
                            } else if (data.type === 'code') {
                                addCodeToDisplay(data.code, data.time, data.is_new);
                                document.getElementById('statusDisplay').classList.add('hidden');
                                try { await navigator.clipboard.writeText(data.code); } catch {}
                            } else if (data.type === 'complete') {
                                document.getElementById('statusDisplay').classList.add('hidden');
                                isRunning = false;
                                startBtn.disabled = false;
                                startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                                btnText.innerHTML = 'üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏∂‡∏á‡πÇ‡∏Ñ‡πâ‡∏î';
                                return;
                            } else if (data.type === 'error') {
                                showStatus(data.message, 'error');
                                isRunning = false;
                                startBtn.disabled = false;
                                startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                                btnText.innerHTML = 'üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏∂‡∏á‡πÇ‡∏Ñ‡πâ‡∏î';
                                return;
                            }
                        }
                    }
                }

            } catch (error) {
                showStatus(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
            } finally {
                isRunning = false;
                startBtn.disabled = false;
                startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                btnText.innerHTML = 'üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏∂‡∏á‡πÇ‡∏Ñ‡πâ‡∏î';
            }
        }
    </script>
</body>
</html>
